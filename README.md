## IMPORTANT NOTE

**Please note that I only recieved the word file named Assignment_-Data_Engineer_July.docx**

**I did NOT recieved the dataset with it but from the word file I saw that this assignment is related to mushroom dataset so few searches on google about mushroom dataset got me to a kaggle link which had the dataset similar to the one defined in the word file**

I got the data from here:
https://www.kaggle.com/uciml/mushroom-classification


# sensyne_health_machine_learning_engineer (Ibad Ur Rahman)
Assessment for Sensyne Health ML engineer test


STEPS TO RUN THIS PROGRAM:

## Environment Setup

```bash
pip install -r requirements.txt
```
make sure to have python 3.8.8 installed
# NOTE
PLEASE RUN ALL CODE IN HOME DIRECTLY

## FILE STRUCTURE
![image](https://user-images.githubusercontent.com/14020143/117579950-51244000-b0ed-11eb-9ff2-7927fb223d99.png)



## ETL Code run

```bash
python etl/1_data_dictionary_creation.py
```
This will simply create a data dictionary, in word file given we have keys and values for different columns, this code will parse that and create a data dictionary which will have the value for each key like grasses=g, etc. This will create a new file on the home directory named data_dictionary.json which will be used by next program


Next is to do the transformation on the main data. Please ensure that mushrooms.csv is present in the home directory
```bash
python etl/2_etl.py
```
1. This code will parse the dictionary file (data_dictionary.json) which contains the key values for all columns
2. Then it will load the mushrooms.csv file in a pandas dataframe
3. It will then validate the data to see if there is any inconsistency between data_dictionary (keys, values) and data itself.
4. It will then transform data by replacing they keys in the data by values derived from dictionary
5. once transformed it will write all of it in mushrooms_transformed.csv file in the home dir

## Database Creation SQLITE
For this task I have chosen SQLITE to be the go to database because of several reasons
1. all of the data in one file hence very feasible for an assignment
2. comes with python
3. no need for environment setup

For database creation run this script
```bash
python db/1_db_data_creation.py
```

1. this code will create the database mushrooms_database.db 
2. this will insert that data from mushrooms_transformed.db to database
3. will do any error checks in inserting


## Detailed Explanation of Database Creation

1. we have used peewee library which is used for ORM (object relational mapping) in python. 
2. Now generally I could have used sql statements itself in order to create the database and insert it into db but I used ORM because with orm we would just have to create the CLASSES in python which will be mapped to the tables in database. In other words I would have to write the classes in python such as mushrooms class which would have the name and the fields in it.
3. the peewee library will turn the classes into sql queries depending on the sql database we have selected
4. The advantage of this is that we dont have to rewrite sql queries for different databases. For example if for now we are using SQLITE it would work fine but when we use POSTGRES etc as well, we would not have to rewrite queries as queries are generated by the peewee library. This is the advantage of ORM
5. Once this is done, then the code will load the transformed data from etl then it will insert the data into the database created.
6. In the end we will see the mushrooms_database.db file which will have the database ready to be accessed


## QUERIES AND THEIR RESULTS
1. There were three questions that were there in word file given and attached as well. 
2. For the answers of those three questions please open the ResultsNotebook.pdf file and in there there is a detail explanation along with code and answers are given
3. If the user intends to view the notebook itself, it is present in
```bash
sql/ResultsNotebook.ipynb
```
4. Along with that the sql queries used are also there in Q1.sql, Q2.sql and Q3.sql




### DATABASE SCHEMA EXPLANATION
I created the db schema keeping into mind the bigger picture that how will the data look when it will be in huge amount.
This dataset is categorical which means that if we use flatfiles and the dataset if huge then many of our spaces will be wasted for that I have created two tables

file:///home/ibadski/Desktop/sensyne_health_ml_engineer/erd.png![image](https://user-images.githubusercontent.com/14020143/117579755-44ebb300-b0ec-11eb-91a7-e304586609cc.png)



Because of the categorical nature of the variables, all columns except for id in mushrooms table are a foreign key which is referenced in allCategories table.
All Categories table will have all unique values in the data.
This schema will be feasible for CATEGORICAL DATABASE. 


One thing to note here is that I have kept the category name itself as the primary key of the category table. in this way our queries will be optimised on the database level at the same time it wont clutter the sql query





### Troubleshooting tips
1. Please note that you need to run the code from your home directory for example :
```bash
#WRONG APPROACH
python 1_data_dictionary_creation.py
```


```bash
#RIGHT APPROACH
python etl/1_data_dictionary_creation.py
```
2. Please also note that first run the programs from ETL folder, then DB folder, then if you want you can run the notebook in SQL folder
3. Please also ensure that mushrooms.csv file is PRESENT in THE HOME DIRECTORY
4. For running notebook you will need jupyter notebook because ther results are interactive and would be better explained in notebook
5. Also if you just want to see the code and results then you can simple open the PDF file in home directory which is THE NOTEBOOK CONVERTED TO PDF via latex
6. THE PDF contains the code plus explanations. The queries used and the graphs are in the pdf and the notebook as well.

